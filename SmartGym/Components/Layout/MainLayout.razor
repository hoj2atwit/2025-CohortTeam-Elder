@inherits LayoutComponentBase
@inject NavigationManager NavigationManager

<CascadingValue Value="this">
    <div class="font-sans">
        @if (NavigationManager.ToBaseRelativePath(NavigationManager.Uri) == "home")
        {
            <HomeLayout />
            <main>
                @Body
            </main>
        }
        else if (string.IsNullOrEmpty(NavigationManager.ToBaseRelativePath(NavigationManager.Uri)) || NavigationManager.ToBaseRelativePath(NavigationManager.Uri) == "login")
        {
            <main class="hero" style="margin-left:0;">
                @Body
            </main>
        }
        else
        {
                <CascadingAuthenticationState>
                    <AuthorizeView>
                        <div class="sidebar border-black-500 border-r-2 bg-primary-900">
                            <NavMenu />
                        </div>
                        <div class="filler" style="width:16rem; top:0; bottom:0; left:0;" />
                    </AuthorizeView>
                </CascadingAuthenticationState>

                <main class="content hero">
                    <div class="boxed">
                        <CascadingAuthenticationState>
                            <AuthorizeView>
                            <div class="sticky top-0 z-10 notification-bar bg-text">
                                    <SearchNavBar @ref=searchNav title=@searchNavTitle isSearchable=@isSearchable />
                                </div>
                            </AuthorizeView>
                        </CascadingAuthenticationState>
                        @Body
                    </div>
                </main>            
        }
        
    </div>

    <div id="blazor-error-ui" data-nosnippet>
        An unhandled error has occurred.
        <a href="." class="reload">Reload</a>
        <span class="dismiss">🗙</span>
    </div>
</CascadingValue>

<footer class="bg-background text-white text-xl">
  <div class="contained my-[30px]">
        <h2 class="uppercase">The true gains start here.</h2>
        <hr />
        2025 Team Elder - OC Donut Steel
  </div>
</footer>

@code
{
    private string searchNavTitle { get; set; } = "Smart Gym";
    private EventCallback<string> searchBarOnChange { get; set; }
    private SearchNavBar? searchNav { get; set; }
    private bool isSearchable { get; set; } = false;

    protected override Task OnParametersSetAsync()
    {
        searchSetupDefault();
        return base.OnParametersSetAsync();
    }

    public async Task setupSearch(string title, EventCallback<string> bodySearchMethod)
    {
        searchNavTitle = title;
        searchBarOnChange = bodySearchMethod;
        isSearchable = true;
        StateHasChanged();
    }

    private Task searchSetupDefault()
    {
        searchNavTitle = "Smart Gym";
        searchBarOnChange = new EventCallback<string>();
        isSearchable = false;
        StateHasChanged();

        return Task.CompletedTask;
    }

    public Task setupNavTitleNoSearch(string s)
    {
        searchNavTitle = s;
        searchBarOnChange = new EventCallback<string>();
        isSearchable = false;
        StateHasChanged();

        return Task.CompletedTask;
    }
}
