@page "/updatebooking/{uId:int}-{cId:int}-{bId:int}"
@using SmartGym.Models
@using SmartGym.Constants.Enums
@using SmartGym.Services
@using Microsoft.AspNetCore.Identity
@inject SmartGym.Services.IBookingService service
@inject NavigationManager navManager

<PageTitle>Update Booking</PageTitle>

    @if (booking == null)
    {
        <LoadingLayout/>
    }
    else
    {
      <h1 class="mb-4" id="title">Update Booking</h1>
      <section class="contained text-xl bg-text" aria-labelledby="title">
            <p>
                <input type="hidden" asp-for="Id" />
                <input type="hidden" asp-for="UserId" />
                <input type="hidden" asp-for="CreatedAt" />
                <input type="hidden" asp-for="ConfirmedAt" />
                <input type="hidden" asp-for="UpdatedAt" />
                <hr />
            </p>
            <p>
				<label for="userid">User ID: </label>@booking.UserId
                <hr />
            </p>
            <p>
				<label for="session">Class Session ID: </label>@booking.ClassSessionId
                <hr />
            </p>
            <p>
				<label for="datecreated">Created at: </label>@booking.CreatedAt
                <hr />
            </p>
            <p>
				<label for="dateconfirmed">Confirmed at: </label>@booking.ConfirmedAt
                <hr />
            </p>
            <p>
				<label for="dateupdated">Updated at: </label>@booking.UpdatedAt
                <hr />
            </p>
            <p>
                <label for="status">Status: </label>
                <select @bind=booking.Status name="status" id="status">
                    <option value="" disabled>Select a status</option>
                    <option value="0">Pending</option>
                    <option value="1" selected>Confirmed</option>
                    <option value="2">Completed</option>
                    <option value="3">No Show</option>
                    <option value="4">Expired</option>
                    <option value="5">Cancelled</option>
                </select>
            </p>
            <p>
                <button @onclick="() => EditBooking(booking.UserId, booking.ClassSessionId, booking.Id)" class="inline-block bg-accent hover:bg-primary text-white font-semibold py-2 px-4 rounded shadow transition duration-150 hover:cursor-pointer">
                    <i class="fa-solid fa-pen-to-square mr-4"></i>Update Booking
                </button>
                <a href="/viewbookings" class="text-secondary">Cancel</a>
            </p>
      </section>
            
            
    }

@code {
    [Parameter]
    public int uId { get; set; }
    [Parameter]
    public int cId { get; set; }
    [Parameter]
    public int bId { get; set; }
    private BookingDTO booking { get; set; }

    protected override async Task OnInitializedAsync()
    {
        booking = await FindBooking();
        StateHasChanged();
    }

    private async Task<BookingDTO> FindBooking()
    {
        List<BookingDTO> bookingList;
        bookingList = await service.GetBookingByUserId(uId);

        foreach (BookingDTO bookingDTO in bookingList)
        {
            if (bookingDTO.Id == bId)
            {
                return bookingDTO;
            }
        }

        return null;
    }

    /// <summary>
    /// Updates a booking
    /// </summary>
    /// <param name="uId"></param>
    /// <param name="cId"></param>
    /// <param name="bId"></param>
    /// <returns></returns>
    private async Task EditBooking(int uId, int cId, int bId)
    {
            // TODO: popup error
            BookingStatus status;
            status = booking.Status;
            booking.UserId = uId;
            booking.ClassSessionId = cId;
            booking.Id = bId;
            booking.UpdatedAt = DateTime.Now;

            navManager.NavigateTo("/viewbookings", true);
        }

}
